{% extends "base.html" %}

{% block title %}{{ item.title }}{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 50px auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
  <h1 style="color: #2c3e50;">{{ item.title }}</h1>
  <p><strong style="color: #2c3e50;">Identifier:</strong> {{ item.identifier }}</p>
  <p><strong style="color: #2c3e50;">Status:</strong> {{ item.status }}</p>
  <p><strong style="color: #2c3e50;">Location:</strong> {{ item.location }}</p>
  <p style="color: #34495e;">{{ item.description }}</p>

  {% if item.image %}
    <img src="{{ item.image.url }}" alt="{{ item.title }}" style="display: block; max-width: 100%; height: auto; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);">
  {% endif %}

  {% if item.collections.exists %}
    <p><strong style="color: #2c3e50;">Collections:</strong>
      {% for col in item.collections.all %}
        <a href="{% url 'collection_detail' col.id %}">{{ col.title }}</a>{% if not forloop.last %}, {% endif %}
      {% endfor %}
    </p>
  {% endif %}

  {% if user.is_authenticated %}
    {% if is_borrowed_by_user %}
      <p style="color: #c0392b;"><strong>You are currently borrowing this item.</strong></p>
    {% elif already_requested %}
      <p style="color: #e67e22;"><strong>You have already requested this item.</strong></p>
    {% elif is_borrowed %}
      <p style="color: #c0392b;"><strong>This item is currently being borrowed.</strong></p>
    {% else %}
      <form method="post" action="{% url 'request_borrow' item.id %}">
        {% csrf_token %}
        <button type="submit" style="margin-top: 20px; padding: 10px 20px; background-color: #2ecc71; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">
          üìö Request to Borrow
        </button>
      </form>
    {% endif %}
  {% endif %}

  {% if user.profile.role == 'librarian' %}
    <a href="{% url 'edit_item' item.id %}" style="color: #3498db; text-decoration: none; font-weight: bold;">‚úèÔ∏è Edit</a>
    &nbsp;
    <a href="{% url 'delete_item' item.id %}" style="color: #3498db; text-decoration: none; font-weight: bold;">üóëÔ∏è Delete</a>
  {% endif %}

  <div class="reviews-section" style="margin-top: 40px; padding: 20px; background-color: #f9f9f9; border-radius: 8px;">
    <h3 style="color: #2c3e50;">Reviews</h3>
    {% if reviews %}
      <ul style="list-style: none; padding: 0;">
        {% for review in reviews %}
          <li style="border-bottom: 1px solid #ecf0f1; padding: 10px 0;">
            <p style="margin: 0;">
              <strong>{{ review.user.username }}</strong>
              <span>
                {% for i in "12345"|make_list %}
                  {% if forloop.counter <= review.rating %}
                    ‚≠ê
                  {% endif %}
                {% endfor %}
              </span>
            </p>
            <p style="margin: 5px 0 0 0;">{{ review.comment }}</p>
            <p style="font-size: 0.9em; color: #7f8c8d;">Reviewed on {{ review.created_at|date:"M d, Y" }}</p>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p style="color: #7f8c8d;">No reviews yet. Be the first to review this item!</p>
    {% endif %}
  </div>
  <a href="{% url 'view_items' %}" class="back-link" style="display: inline-block; margin-top: 20px; color: #3498db; text-decoration: none; font-weight: bold;">
    ‚Üê Back to Items
  </a>
</div>
{% endblock %}
