{% extends "base.html" %}
{% block title %}My Borrowed Items{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 50px auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
  <h2 style="color: #2c3e50;">📚 My Borrowed Items</h2>

  {% if user.is_authenticated %}
    <p style="color: #7f8c8d;">Hello, {{ user.username }}! Here are the items you are currently borrowing:</p>
  {% else %}
    <p>{{ error_message }}</p>
    <p><a href = "{% url 'home' %}">Go back to home</a></p>
  {% endif %}

  {% if reviews_by_item %}
    <h3 style="color: #2980b9;">Your Reviews</h3>
    <ul style="list-style: none; padding: 0;">
      {% for item_id, review in reviews_by_item.items %}
        <li style="margin-bottom: 20px; border-bottom: 1px solid #ecf0f1; padding-bottom: 10px;">
          <strong>{{ review.item.title }}</strong><br>
          <span style="color: #7f8c8d;">Reviewed on {{ review.created_at|date:"M d, Y H:i" }}</span><br>
          <span style="color: #2ecc71;">Rating: {{ review.rating }} ⭐</span><br>
          <p>{{ review.text }}</p>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
  {% if borrowed_items %}
    <ul style="list-style: none; padding: 0;">
      {% for entry in borrowed_items %}
        <li style="margin-bottom: 20px; border-bottom: 1px solid #ecf0f1; padding-bottom: 10px;">
          <strong>{{ entry.item.title }}</strong><br>
          <span style="color: #7f8c8d;">Requested at {{ entry.requested_at|date:"M d, Y H:i" }}</span><br>

          <form method="post" action="{% url 'return_borrowed_item' entry.id %}" style="margin-top: 10px; display: inline-block;">
            {% csrf_token %}
            <button type="submit" style="padding: 6px 14px; background-color: #e67e22; color: white; border: none; border-radius: 4px; font-weight: bold;">📦 Return</button>
          </form>

          {% if entry.item.id in reviews_by_item %}
            <a href="{% url 'submit_review' entry.item.id %}" style="margin-left: 10px; padding: 6px 14px; background-color: #2980b9; color: white; border-radius: 4px; font-weight: bold; text-decoration: none; display: inline-block;">
              📝 Edit Review
            </a>
          {% else %}
            <a href="{% url 'submit_review' entry.item.id %}" style="margin-left: 10px; padding: 6px 14px; background-color: #f1c40f; color: #2c3e50; border-radius: 4px; font-weight: bold; text-decoration: none; display: inline-block;">
              ⭐ Leave a Review
            </a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    {% if user.is_authenticated %}
    <p style="color: #7f8c8d;">You are not currently borrowing any items.</p>
    {%endif%}
  {% endif %}
  {%if user.is_authenticated %}
    <a href="{% url 'home' %}" class="back-link" style="display: inline-block; margin-top: 20px; color: #3498db; text-decoration: none; font-weight: bold;">
      ← Back to Dashboard
    </a>  
  {%endif %}
</div>
{% endblock %}
